<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Quote of the Day</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
      display: flex;
      min-height: 100vh;
      align-items: center;
      justify-content: center;
    }

    .card {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      max-width: 420px;
      width: 100%;
      text-align: center;
    }

    h1 {
      font-size: 1.4rem;
      margin-bottom: 1rem;
    }

    #quote {
      font-size: 1rem;
      line-height: 1.5;
      margin-bottom: 1.5rem;
      color: #333;
      min-height: 3em;
    }

    button {
      padding: 0.6rem 1.2rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      background: #111827;
      color: white;
      margin: 0.25rem;
    }

    button:hover {
      opacity: 0.9;
    }

    textarea {
      font-family: inherit;
      font-size: 0.9rem;
      padding: 0.5rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      resize: vertical;
    }

    #saved {
      min-height: 1.2em;
      font-size: 0.9rem;
      color: #555;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Quote of the Day</h1>
    <p id="quote">Click the button to see a quote.</p>

    <button id="new-quote">New quote</button>
    <button id="favourite">‚ù§Ô∏è Save favourite</button>
<button id="deleteQuote">üóëÔ∏è Delete this quote</button>
<button id="openBin">‚ôªÔ∏è Recycle bin</button>

    <p id="saved"></p>

    <textarea
      id="customQuote"
      placeholder="Write your own quote..."
      rows="3"
      style="width:100%; margin-top:1rem;"
    ></textarea>
    <br><br>
    <button id="addQuote">Add quote</button>
    <br><br>
    <button id="viewFavourite">View favourite</button>
  </div>

  <script>
    // ---- DEFAULT QUOTES (first-time only) ----
    const defaultQuotes = [
      "Life is really simple, but we insist on making it complicated.",
      "The present moment is all you ever have.",
      "You are not a drop in the ocean. You are the entire ocean in a drop.",
      "What you seek is seeking you.",
      "Silence is a source of great strength."
    ];

    // ---- LOAD ALL QUOTES (including any older ones we saved before) ----
    let allQuotes = JSON.parse(localStorage.getItem("allQuotes"));
    if (!Array.isArray(allQuotes) || allQuotes.length === 0) {
      // try migrate from older key if it exists
      const legacy = JSON.parse(localStorage.getItem("quotesList"));
      if (Array.isArray(legacy) && legacy.length > 0) {
        allQuotes = legacy;
      } else {
        allQuotes = defaultQuotes.slice();
      }
    }

    function saveAllQuotes() {
      localStorage.setItem("allQuotes", JSON.stringify(allQuotes));
    }

    // ---- NON-REPEATING ORDER ("shuffle bag") ----
    let order = JSON.parse(localStorage.getItem("quoteOrder"));
    let orderIndex = parseInt(localStorage.getItem("quoteOrderIndex") || "0", 10);

    function resetOrder() {
      order = [];
      for (let i = 0; i < allQuotes.length; i++) {
        order.push(i);
      }
      // Fisher‚ÄìYates shuffle
      for (let i = order.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [order[i], order[j]] = [order[j], order[i]];
      }
      orderIndex = 0;
      localStorage.setItem("quoteOrder", JSON.stringify(order));
      localStorage.setItem("quoteOrderIndex", String(orderIndex));
    }

    // if order is broken or length doesn't match, reset
    if (!Array.isArray(order) || order.length !== allQuotes.length) {
      resetOrder();
    }

    // ---- DOM ELEMENTS ----
    const quoteElement = document.getElementById("quote");
    const newQuoteButton = document.getElementById("new-quote");
    const favouriteButton = document.getElementById("favourite");
    const deleteButton = document.getElementById("deleteQuote");
const binButton = document.getElementById("openBin");
binButton.addEventListener("click", () => {
  window.location.href = "bin.html";
});

    const savedText = document.getElementById("saved");
    const viewButton = document.getElementById("viewFavourite");
    const addButton = document.getElementById("addQuote");
    const input = document.getElementById("customQuote");

    // track what is currently shown (by index)
    let currentIndex = null;

    function showNextQuote() {
      if (!Array.isArray(order) || order.length === 0) {
        resetOrder();
      }
      if (orderIndex >= order.length) {
        // we've shown all quotes once; start a new shuffled cycle
        resetOrder();
      }
      const idx = order[orderIndex];
      currentIndex = idx;
      quoteElement.textContent = allQuotes[idx];
      savedText.textContent = "";
      orderIndex++;
      localStorage.setItem("quoteOrderIndex", String(orderIndex));
    }

    newQuoteButton.addEventListener("click", showNextQuote);

    // ---- SAVE FAVOURITE (current quote text) ----
    favouriteButton.addEventListener("click", () => {
      const currentQuote = quoteElement.textContent.trim();
      if (!currentQuote || currentQuote === "Click the button to see a quote.") {
        savedText.textContent = "Show a quote first!";
        return;
      }

      let favourites = JSON.parse(localStorage.getItem("favouritesList")) || [];

      if (!favourites.includes(currentQuote)) {
        favourites.push(currentQuote);
        localStorage.setItem("favouritesList", JSON.stringify(favourites));
        savedText.textContent = "Saved!";
      } else {
        savedText.textContent = "Already saved!";
      }
    });

    // ---- ADD A NEW CUSTOM QUOTE ----
    addButton.addEventListener("click", () => {
      const newQuote = input.value.trim();

      if (!newQuote) {
        savedText.textContent = "Write something first!";
        return;
      }

      // add to main quote pool if not already there
      if (!allQuotes.includes(newQuote)) {
        allQuotes.push(newQuote);
        saveAllQuotes();

        // also add its index into the order so it will appear in the cycle
        const newIndex = allQuotes.length - 1;
        if (!Array.isArray(order)) {
          order = [];
        }
        order.push(newIndex);
        localStorage.setItem("quoteOrder", JSON.stringify(order));
      }

      // also add to favourites
      let favourites = JSON.parse(localStorage.getItem("favouritesList")) || [];
      if (!favourites.includes(newQuote)) {
        favourites.push(newQuote);
        localStorage.setItem("favouritesList", JSON.stringify(favourites));
      }

      // show the new quote immediately
      currentIndex = allQuotes.length - 1;
      quoteElement.textContent = newQuote;
      savedText.textContent = "Quote added!";
      input.value = "";
    });

    // ---- NAVIGATE TO FAVOURITES PAGE ----
    viewButton.addEventListener("click", () => {
      window.location.href = "favourite.html";
    });
  deleteButton.addEventListener("click", () => {
  if (currentIndex === null) {
    savedText.textContent = "No quote to delete.";
    return;
  }

  const quoteToDelete = allQuotes[currentIndex];

  // Load recycle bin
  let recycleBin = JSON.parse(localStorage.getItem("recycleBin")) || [];
  recycleBin.push(quoteToDelete);
  localStorage.setItem("recycleBin", JSON.stringify(recycleBin));

  // Remove from main list
  allQuotes.splice(currentIndex, 1);
  localStorage.setItem("allQuotes", JSON.stringify(allQuotes));

  // Remove from favourites
  let favourites = JSON.parse(localStorage.getItem("favouritesList")) || [];
  favourites = favourites.filter(q => q !== quoteToDelete);
  localStorage.setItem("favouritesList", JSON.stringify(favourites));

  // Reset rotation
  resetOrder();

  if (allQuotes.length > 0) {
    showNextQuote();
  } else {
    quoteElement.textContent = "No quotes left.";
  }

  savedText.textContent = "Moved to recycle bin.";
});

  if (currentIndex === null) {
    savedText.textContent = "No quote to delete.";
    return;
  }

  const quoteToDelete = allQuotes[currentIndex];

  // Remove from main quotes
  allQuotes.splice(currentIndex, 1);
  localStorage.setItem("allQuotes", JSON.stringify(allQuotes));

  // Remove from favourites
  let favourites = JSON.parse(localStorage.getItem("favouritesList")) || [];
  favourites = favourites.filter(q => q !== quoteToDelete);
  localStorage.setItem("favouritesList", JSON.stringify(favourites));

  // Reset rotation order
  resetOrder();

  // Show next quote or fallback
  if (allQuotes.length > 0) {
    showNextQuote();
  } else {
    quoteElement.textContent = "No quotes left.";
  }

  savedText.textContent = "Deleted.";
});

  </script>
</body>
</html>

